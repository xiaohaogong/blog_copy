---
title: Line tracking robot.
date: '2019-10-20'
metaDesc: "Briefly explain the robot line patrol"
socialImage: true
tags:
  - steam edu
---
EV3巡线编程测试

## 切换

![转左或者转右，没有直行的情况](https://i.loli.net/2020/04/29/IFOaG8yNU7XPCt4.png)

![直行的情况](https://i.loli.net/2020/04/29/HiA3xW4kOlqI2yQ.png)

> 在其基础上,也可以去设置更多的运动状态,比如加入向左急转,向左稍微转弯,直行,向右稍微转弯,向右急转.这些都可以用切换模块来实现.然而这些无法满足千奇百怪的巡线路径.所以程序继续优化.

## 比例巡线

这里就要引入误差值,增益值以及转向值.
比例巡线是根据目标值(机器人走直线时颜色传感器的值,计算公式:目标值= (最大值+最小值) /2) 和输入值(颜色传感器实际测量的值)来改变控制变量(控制变量我理解为移动转向模块里的转向值)的.

增益值决定了机器人对误差值变化的反应速度,是自己设置或者调试得到.

误差值=目标值-输入值
转向值=误差值*增益值

![比例巡线](https://i.loli.net/2020/07/19/icOBxljWSCJtnQY.png)

增益值需要反复的实验,找到最合适的增益值.用你自己的目标值和增益值测试这个程序,运行效果应该比切换程序更好.

## PID巡线

_PID控制器--比例-微分-积分控制器_

和比例控制器一样,PID控制器也是用颜色传感器读数来调整起到控制作用的变量,也就是转向值.

   首先我们要采集颜色传感器的最大值和最小值,这个部分可以通过挪动机器人来实现,也可以让机器人自己完成.如何让机器人自己完成呢?首先我们需要一个机器人,然后写入程序就可以了.怎样知道颜色传感器采集的数值呢?将采集到的数值显示出来就可以了,这里需要用到显示模块.

   ![文本和显示](https://i.loli.net/2020/07/19/PYWQoKtfN5LpAvB.png)

   ![我的模块创建器](https://i.loli.net/2020/07/19/Qbnh8VXFxRWIokN.png)

   ![参数编辑](https://i.loli.net/2020/07/19/fJDKPdpiCjXt4nO.png)

   ![我的模块](https://i.loli.net/2020/07/19/5Gzsqk8NyJmEOXL.png)

   ![连线](https://i.loli.net/2020/07/19/iSCGyTrfl1sn3jX.png)

   下面是完整的机器人自己读取最大值和最小值的程序

   ![读取最大值和最小值](https://i.loli.net/2020/07/19/cGX6r5fp7VAdJ3R.png)

   取得最大值和最小值之后又该怎么做呢?书上提到标准化传感器读数和目标值,公式是:标准化读数=100*（传感器读数-最小值）/（最大值-最小值）  它有什么好处呢？举个例子，不同的环境，不同的颜色，反射光值是不同的。以线路A最小值10和最大值80，线路B最小值30和最大值60为例，它们的目标值都是45，但是数值的范围不同，那么机器人对于这两种线路应该是不同的反应。线路A颜色传感器读数为60时，它还在线的边缘，而对于线路B它可能已经完全脱离线了。使用标准化读数之后，线路A的60，标准化为71，而线路B的60标准化为100。这个时候就反映出标准化读数的实用性，合理性。
     之前我们提到过目标值和误差值，在这里我们都将它们标准化。以线路A为例
     目标值45，标准化目标值为50     那么：误差值（Error）=目标值-测量值，标准化误差值=50-100*（测量值-10）/70
     ![标准化值](https://i.loli.net/2020/07/19/G3jCR7wqg4EYVtP.png)
     之前写到过 转向值=误差值*增益值。
    这里我们将增益值记为Kp，这里就是PID里的P部分。
    PID里的转向值，转向值=误差Kp+微分✖Kd+积分✖Ki。
    误差：Error，微分：Weifen，积分：Jifen。
    Weifen=Error-上一个Error。新的Jifen=0.5*Jifen+Error。
![微分项](https://i.loli.net/2020/07/19/UN1o8kKGdMvzx9c.png)
![积分项](https://i.loli.net/2020/07/19/SVRb9X8zIx2oTUH.png)
![转向值](https://i.loli.net/2020/07/19/PWi9qSBXaGLJAbT.png)